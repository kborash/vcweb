{% extends "base-participant.html" %}
{% block head %}
{{ block.super }}
<script type="text/javascript">
    $(function() {
        $("#forestry-form").validate({
                rules: {
                    harvest_decision: {
                        required: true,
                        range: [0, {{max_harvest_decision}}]
                    }
                },
                messages: {
                    harvest_decision: {
                        required: "Please enter a harvest decision",
                        range: "Please enter a number between 0 and {{ max_harvest_decision }}"
                    }
                },
        });
        $('#harvest-decision-id').focus(function() {
            this.select();
        });
        $('#harvest-decision-id').focus();
        var s = getCachedSocket();
        s.on('message', function(json_string) {
            var json = jQuery.parseJSON(json_string);
            switch (json.message_type) {
            case 'goto':
                console.log("going to " + json.url);
                window.location.href = json.url;
                break;
            }
        });
        $('#forestry-form').submit(function() {
            $(this).attr('disabled', true);
            harvestDecisionValue = $('#harvest-decision-id').val();
            s.send(createSubmitEvent($('#harvest-decision-id').val()));
            return true;
        });
    });
</script>
{% endblock %}
{% block title %}
Participating in {{experiment.status_line}}
{% endblock %}
{% block content %}
<h3>Forestry round number {{ experiment.current_round.round_number }}</h3>
{% for i in number_of_resource_divs %}
<div style="background: url('/static/images/forestry/pine-tree.png') repeat-x; width:{{max_width}}px; height: 79px;">
    &nbsp;
</div>
{% endfor %}
{% if resource_width > 0 %}
<div style="background: url('/static/images/forestry/pine-tree.png') repeat-x; width:{{resource_width}}px; height: 79px;">
    &nbsp;
</div>
{% endif %}
<div class='ui-state-highlight'>
    <span class='icon-left ui-icon ui-icon-info'></span>
    There are <b>{{ resource_level.value }}</b> trees left.
</div>
    <div class='ui-state-error'>
        <span class='icon-left ui-icon ui-icon-info'></span>
        Your current harvest decision is <b>{{ harvest_decision.value }}</b>
    </div>
{% if max_harvest_decision > 0 %}
<form id='forestry-form' action='' method='post'>
    <div class='field'>
        <br/>
        <label for='harvest-decision-id'>How many trees will you harvest this round? <br/><small><b>Choose a number between 0 and {{ max_harvest_decision }}</small></b>:</label>
        <input id='harvest-decision-id' type="text" name='harvest_decision' class='required digits two-digits' maxlength='1'/>
    </div>
    <div class='field'>
        <input type='submit' value='Save' />
    </div>
</form>
{% else %}
<div class='alert ui-corner-all'>
    <span class='ui-icon ui-icon-alert'></span>
    There aren't enough resources to harvest.
</div>
{% endif %}
{% endblock content %}
