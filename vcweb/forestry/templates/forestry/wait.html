{% extends "participant/base.html" %}
{% block title %}
Forestry Experiment Round {{ experiment.current_round.round_number }}
{% endblock %}
{% block page %}
<h3>Waiting for the next round to start</h3>
<p>
Please wait, the facilitator will start the next round when every participant is ready.
</p>
<div class='alert alert-message'>
    You are <span class='text-info'>Participant #{{participant_group_relationship.participant_number}} ({{participant_experiment_relationship.pk}}, {{participant_experiment_relationship.sequential_participant_identifier}})</span> in 
    <span style='padding: 3px;' class='ui-state-highlight'>{{participant_group_relationship.group}}</span>
</div>
<div class='alert alert-message'>
    <i class='icon-arrow-left''></i><a href='participate'>return to participation page</a>
</div>
<h3>Participant History</h3>
<div id='group-history'>
    {% if participant_history %}
    <table id='participant-history' class='tablesorter'>
        <thead>
            <tr>
                <th style='width:9em;'>Round</th>
                <th style='width:9em;' class='tooltip' title='The number of trees available to your group at the start of the round.'>Initial # trees (A)</th>
                <th style='width:8em;' class='tooltip' title='The number of trees you harvested in this round.'>Your harvest decisions</th>
                <th style='width:12em;' class='tooltip' title='The total number of trees harvested by your group in this round.'>
                    Total group harvest decisions (B)
                </th>
                <th class='tooltip' title='The trees that regrew during this round (C = (A - B) * 0.10)'>Trees regrown (C)</th>
                <th class='tooltip' title='The number of trees available at the end of the round (A - B + C = D).'>Final # trees (D)</th></tr>
        </thead>
        <tbody>
            {% for harvest_round_data in participant_history %}
            <tr>
                <td>
                    {% if harvest_round_data.round_in_progress %}
                    <div id='round-in-progress' class='alert alert-message' title='This round is still in progress so only your harvest decision for this round is being shown.'>
                        Round in progress
                    </div>
                    {% endif %}
                    {{harvest_round_data.round_configuration.display_label}}
                    <br/><small>{{harvest_round_data.round_configuration.sequence_label}}</small></td>
                <td>{{harvest_round_data.original_number_of_trees}}</td>
                <td>{% if harvest_round_data.individual_harvest %}
                    {{harvest_round_data.individual_harvest.value}}
                    {% else %}
                    0
                    {%endif%}
                </td>
                {% with sequence_number=harvest_round_data.round_configuration.sequence_number %}
                <td id='group_harvest_{{sequence_number}}'>{{harvest_round_data.group_harvest.value}}</td>
                <td id='group_regrowth_{{sequence_number}}'>{{harvest_round_data.group_regrowth.value}}</td>
                <td id='final_number_of_trees_{{sequence_number}}'>{{harvest_round_data.final_number_of_trees}}</td>
                {% endwith %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% endif %}
</div>
{% endblock %}
{% block footer %}
{{ block.super }}
{% include "includes/tablesorter.html" %}
<script type="text/javascript">
    $(function() {
        $('#participant-history').tablesorter({widgets: ['zebra'],
            headers: { 0: {sorter: false}, 1: {sorter: false} }
        });
        var s = connect();
        s.onmessage = function(json_string) {
            var json = jQuery.parseJSON(json_string);
            switch (json.message_type) {
            case 'update':
                console.log("updating data");
                break;
            case 'goto':
                console.log("going to " + json.url);
                window.location.href = json.url;
                break;
            case 'refresh':
                window.location.reload(true);
                break;
            }
        };
    });
</script>
{% endblock %}

