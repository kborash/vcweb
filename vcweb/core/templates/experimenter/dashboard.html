{% extends "experimenter/base.html" %}
{% block title %}Virtual Commons Web Experimenter Dashboard{% endblock %}
{% block page %}
{{ block.super }}
<h3>Experimenter Dashboard</h3>
{% comment %} FIXME: UI refinement needed as the list of experiments grows {% endcomment %}
<div id="experiment-list">
    {% for e in experiments %}
    <div class='alert alert-message'>
        <h4>{{e.status_line}} <span class='pull-right'><span class='badge badge-important'>{{e.participant_set.count}}</span> participants</span></h4>
        <div class='btn-group'>
            <a class='btn' href='{{e.monitor_url}}'><i class='icon-zoom-in'></i> monitor</a></li>
            <a class='btn confirm-experiment-action' data-content='Creates a new copy of this experiment with the same configuration and no participants.'
                href='{{e.clone_url}}'><i class='icon-copy'></i> clone</a>
            {% if not e.is_archived %}
            {% if e.participant_set.count == 0  %}
            <a class='btn' data-content='Register participants for this experiment with actual email addresses' href='{{e.controller_url}}/register-email-list'>
                <img src='{{STATIC_URL}}images/famfamfam/group_add.png' alt='register'/> register participants</a>
            <a data-content='Register participants for this experiment with fake email addresses by providing an email suffix and the number of participants.' 
                class='btn' href='{{e.controller_url}}/register-simple'>
                <img src='{{STATIC_URL}}images/famfamfam/group_add.png' alt='register'/> test participants</a>
            {% else %}
            <a data-content='Remove all participants from the experiment, including any data they may have generated.' href='{{e.controller_url}}/clear-participants' class='btn confirm-experiment-action'>
                <i class='icon-trash'></i> clear all participants</a></li>
            {% endif %}
            {% if e.is_active %}
            <a data-action='complete' data-content='Mark this experiment as completed' href='{{e.complete_url}}' class='btn confirm-experiment-action'><i class='icon-save'></i> archive</a>
            <a data-action='deactivate' data-content='deactivate this experiment' href='{{e.deactivate_url}}' class='btn confirm-experiment-action'><i class='icon-off'></i> deactivate</a>
            {% else %}
            <a class='btn' data-content='Configure this experiment' href='{{e.configure_url}}'><i class='icon-wrench'></i> configure</a>
            {% endif %}
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class='alert alert-error'>
        You are not currently running any experiments.
    </div>
    {% endfor %}
</div>
{% endblock page %}
{% block javascript %}
{{ block.super }}
<script type='text/javascript'>
    $(function() {
        $('a.confirm-experiment-action').on("click", function(evt) {
            evt.preventDefault();
            var self = $(this);
            var description = self.attr("data-content");
            var href = self.attr("href");
            if (self.hasClass('disabled')) {
                console.debug("disabled action " + action + " - ignoring");
                return false;
            }
            bootbox.confirm(description + "  Continue?", function(confirmed) {
                if (confirmed) {
                    window.location = self.attr("href");
                }
            });
            return false;
        });
    });
</script>
{% endblock %}

